{"version":3,"file":"library.js","sources":["../src/js/lib-list.js"],"sourcesContent":["import { showDetailsPopup, renderStarRating } from './catalog-hero.js';\n\nimport { fetchGenres } from './fetchApi.js';\n\nlet genreMap = {};\nfetchGenres().then(map => {\n  genreMap = map;\n  renderLibraryFilms(true); // genreMap dolduktan sonra render et\n});\n\n\nconst LIBRARY_KEY = 'myLibrary';\nconst filmList = document.getElementById('library-film-list');\nconst emptySection = document.getElementById('empty-library');\nconst loadMoreBtn = document.getElementById('load-more-btn');\n\nlet allFilms = [];\nlet currentIndex = 0;\nconst PAGE_SIZE = 9;\n\n\nfunction renderLibraryFilms(reset = false, customFilms = null) {\n  if (reset) {\n    allFilms = JSON.parse(localStorage.getItem(LIBRARY_KEY)) || [];\n    currentIndex = 0;\n    filmList.innerHTML = '';\n  }\n\n  const filmsToShow = customFilms || allFilms;\n\n  // Genre select'i bul\n  const genreSelectContainer = document.querySelector('.genre-container');\n\n  if (filmsToShow.length === 0) {\n    emptySection.classList.remove('hidden');\n    filmList.innerHTML = `<div class=\"library-container\"><p>OOPS...<br />We are very sorry!<br />You don’t have any movies at your library.</p>\n    <button class=\"search-movie\" onclick=\"window.location.href='catalog.html'\">Search movie</button>\n    </div>`;\n    loadMoreBtn.style.display = 'none';\n    // Genre select'i gizle\n    if (genreSelectContainer) genreSelectContainer.style.display = 'none';\n    return;\n  }\n\n  emptySection.classList.add('hidden');\n  // Genre select'i göster\n  if (genreSelectContainer) genreSelectContainer.style.display = '';\n\n  emptySection.classList.add('hidden');\n\n  // Sonraki 9 filmi ekle\n  const nextFilms = filmsToShow.slice(currentIndex, currentIndex + PAGE_SIZE);\n  nextFilms.forEach(film => {\n    const {\n      title,\n      poster_path,\n      release_date,\n      vote_average,\n      genre_ids,\n      genres,\n    } = film;\n    const year = release_date ? release_date.slice(0, 4) : 'N/A';\n    const poster = poster_path\n      ? `https://image.tmdb.org/t/p/w500${poster_path}`\n      : 'https://via.placeholder.com/395x574?text=No+Image';\n\n    const genreText = Array.isArray(genres) && genres.length\n      ? genres.join(', ')\n      : Array.isArray(genre_ids) && genre_ids.length\n        ? genre_ids.map(id => genreMap[id] || id).join(', ')\n        : '';\n\n    const li = document.createElement('li');\n    li.className = 'weekly-card';\n    li.innerHTML = `\n      <div class=\"weekly-card__image-wrapper\">\n        <img class=\"weekly-card__image\" src=\"${poster}\" alt=\"${title}\">\n        <div class=\"weekly-card__overlay\"></div>\n      </div>\n      <div class=\"weekly-card__info\">\n        <h3 class=\"weekly-card__title\">${title}</h3>\n        <div class=\"weekly-card__meta-row\">\n          <p class=\"weekly-card__meta\">${genreText} | ${year}</p>\n          <div class=\"weekly-card__rating\"></div>\n        </div>\n      </div>\n    `;\n\n    if (typeof renderStarRating === 'function') {\n      const ratingContainer = li.querySelector('.weekly-card__rating');\n      renderStarRating(vote_average, ratingContainer);\n    }\n\n    li.addEventListener('click', () => {\n      showDetailsPopup(film, () => renderLibraryFilms(true));\n    });\n\n    filmList.appendChild(li);\n  });\n\n  currentIndex += PAGE_SIZE;\n\n  if (currentIndex < filmsToShow.length) {\n    loadMoreBtn.style.display = 'block';\n  } else {\n    loadMoreBtn.style.display = 'none';\n  }\n}\n\n// Sayfa yüklendiğinde filmleri göster\ndocument.addEventListener('DOMContentLoaded', () => {\n  renderLibraryFilms(true);\n});\n\n// Load more butonuna tıklanınca\nloadMoreBtn.addEventListener('click', () => {\n  renderLibraryFilms();\n});\n\n\n\nconst genreSelect = document.getElementById('genre-filter');\n\ngenreSelect.addEventListener('change', () => {\n  const selectedGenre = genreSelect.value;\n  // Tüm filmleri localStorage'dan al\n  const allFilms = JSON.parse(localStorage.getItem(LIBRARY_KEY)) || [];\n\n  // \"Genre\" seçiliyse hepsini göster\n  if (selectedGenre === 'Genre') {\n    renderLibraryFilms(true);\n    return;\n  }\n\n  // Filtrele: genres veya genre_ids içinde seçili tür var mı?\n  const filteredFilms = allFilms.filter(film => {\n    // genres dizi ise (isim olarak)\n    if (Array.isArray(film.genres) && film.genres.includes(selectedGenre)) {\n      return true;\n    }\n    // genre_ids dizi ise (id olarak)\n    if (Array.isArray(film.genre_ids) && genreMap) {\n      return film.genre_ids.some(id => genreMap[id] === selectedGenre);\n    }\n    return false;\n\n\n    \n  });\n\n  currentIndex = 0;\n  filmList.innerHTML = '';\n  renderLibraryFilms(false, filteredFilms);\n});\n\n\n\n\n\n"],"names":["genreMap","fetchGenres","map","renderLibraryFilms","LIBRARY_KEY","filmList","emptySection","loadMoreBtn","allFilms","currentIndex","PAGE_SIZE","reset","customFilms","filmsToShow","genreSelectContainer","film","title","poster_path","release_date","vote_average","genre_ids","genres","year","poster","genreText","id","li","renderStarRating","ratingContainer","showDetailsPopup","genreSelect","selectedGenre","filteredFilms"],"mappings":"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"}